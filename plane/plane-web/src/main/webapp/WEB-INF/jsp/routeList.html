<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>路由分布</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/highcharts-4.1.min.js"></script>
    <script type="text/javascript" src="js/oc.min.js"></script>
    <link rel="icon" type="image/png" href="i/ico.png" sizes="16x16">
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <script src="http://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="http://webapi.amap.com/maps?v=1.4.6&key=82f9e75505b649be9ab81a45ae34aa14"></script>
    <link href="css/common.css" rel="stylesheet" type="text/css">

</head>

<body>

<!-- top 导航 -->
<#include "common/header.html" />
<#include "./nav.html" />
<div class="content">
    <div class="container-fluid">

        <div class="row-fluid">
            <div class="block span6">
                <div id="container"></div>
                <!-- UI组件库 1.0 -->
                <script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
                <script type="text/javascript">
                    //闪烁点
                    //just some colors
                    var colors = ['#0cc2f2', '#ff9e00', '#ff1800'];
                    var routeStatusCode = ['一干路由', '二干路由', '混合路由'];
                    //var Imgsrc = ['start1-32.png', 'start2-32.png', 'start3-32.png'];
                    /* var routeList = [{
                        routeid: '2',
                        status: '0',
                        routepath: [
                            [107.79962, 23.06691], // 2144  起飞点
                            [107.79985, 23.06666], // 2143
                            [107.80006, 23.06645], // 2142
                            [107.80033, 23.06617], // 2141
                            [107.80079, 23.06568], // 2140
                            [107.80103, 23.06544], // 2139
                            [107.80121, 23.06524], // 2138
                            [107.80143, 23.06500], // 2137
                            [107.80164, 23.06481], // 2136
                            [107.80214, 23.06427], // 2135
                            [107.80226, 23.06413], // 2134+2
                            [107.80245, 23.06394], // 2134+1
                            [107.80264, 23.06376], // 2134
                            [107.80283, 23.06354], // 2133
                            [107.80310, 23.06329], // 2132
                            [107.80330, 23.06305], // 2131
                            [107.80338, 23.06280], // 2130
                            [107.80345, 23.06262], // 2129
                            [107.80349, 23.06253], // 2128
                            [107.80363, 23.06209], // 2127
                            [107.80367, 23.06200], // 2126
                            [107.80370, 23.06188], // 2125
                            [107.80373, 23.06178], // 2124
                            [107.80386, 23.06140], // 2123
                            [107.80396, 23.06104], // 2122
                            [107.80402, 23.06079], // 2121
                            [107.80412, 23.06069], // 2120
                            [107.80436, 23.06050], // 2119
                            [107.80465, 23.06029], // 2118
                            [107.80486, 23.06015], // 2117
                            [107.80520, 23.05990], // 2116
                            [107.80543, 23.05976], // 2116+2
                            [107.80568, 23.05958], // 2116+1
                            [107.80607, 23.05926], // 2115
                            [107.80645, 23.05895], // 2114
                            [107.80674, 23.05875], // 2113
                            [107.80708, 23.05849], // 2112
                            [107.80736, 23.05829], // 2111
                            [107.80767, 23.05807], // 2110 折返点
                        ],
                        descripte: '这是一条一干路由,无人机路过',
                        updatetime: '2018-8-1',
                        type: '1',
                    }]; */
                    routeList = ${routeList};
                    //创建一个地图
                    var map = new AMap.Map('container', {
                        resizeEnable: true,
                        center: routeList[0].routePath[0],
                        zoom: 13
                    });
                    AMapUI.loadUI(['control/BasicControl'], function (BasicControl) {
                        //缩放控件，显示Zoom值
                        map.addControl(new BasicControl.Zoom({
                            position: 'lt',
                            showZoomNum: true,
                        }));
                    });
                    var infoWindow = new AMap.InfoWindow({
                        isCustom: true,
                        offset: new AMap.Pixel(20, -35)
                    });

                    function showrouteList(RouteList) {
                        for (var i = 0; i < routeList.length; i++) {
                            var polyline = new AMap.Polyline({
                                map: map,
                                path: RouteList[i].routePath, //设置线覆盖物路径
                                strokeColor: colors[Number(RouteList[i].type)], //线颜色
                                strokeOpacity: 1, //线透明度
                                strokeWeight: 5, //线宽
                                strokeStyle: "solid", //线样式
                                strokeDasharray: [10, 5] //补充线样式
                            });
                        }
                    }

                    showrouteList(routeList);

                    AMapUI.loadUI(['overlay/SimpleMarker'], function (SimpleMarker) {


                        for (var i = 0; i < routeList.length; i++) {
                            //启动页面
                            var lineColor = null;
                            var pointFont = null;
                            if (routeList[i].type == '0') {
                                pointFont = '<i>一干</i>';
                                lineColor = 'green';
                            } else if (routeList[i].type == '1') {
                                pointFont = '<i>二干</i>';
                                lineColor = 'darkblue';
                            } else {
                                pointFont = '<i>混合</i>';
                                lineColor = 'purple';
                            }
                            var Onestart = new SimpleMarker({
                                //前景文字
                                map: map,
                                iconLabel: {
                                    innerHTML: pointFont, //设置文字内容
                                    style: {
                                        color: 'white' //设置文字颜色
                                    }
                                },
                                iconTheme: 'fresh',
                                //背景图标样式
                                iconStyle: lineColor,
                                position: routeList[i].routePath[0],
                            });

                            //实例化信息窗体

                            var title = '路由编号：<span>' + routeList[i].routeId + '</span>';
                            var content = [];
                            content.push("类型：" + routeStatusCode[Number(routeList[i].type)]);
                            content.push("描述：" + routeList[i].descripte);
                            content.push("更新时间：" + routeList[i].updateTime);

                            Onestart.content = createInfoWindow(title, content.join("<br/>"));
                            Onestart.on('click', markerClick);
                        }
                    });

                    //构建自定义信息窗体
                    function createInfoWindow(title, content) {
                        var info = document.createElement("div");
                        info.className = "info";

                        //可以通过下面的方式修改自定义窗体的宽高
                        //info.style.width = "400px";
                        // 定义顶部标题
                        var top = document.createElement("div");
                        var titleD = document.createElement("div");
                        var closeX = document.createElement("img");
                        top.className = "info-top";
                        titleD.innerHTML = title;
                        closeX.src = "i/close2.gif";
                        closeX.onclick = closeInfoWindow;

                        top.appendChild(titleD);
                        top.appendChild(closeX);
                        info.appendChild(top);

                        // 定义中部内容
                        var middle = document.createElement("div");
                        middle.className = "info-middle";
                        middle.style.backgroundColor = 'white';
                        middle.innerHTML = content;
                        info.appendChild(middle);
                        return info;
                    }

                    //打开信息窗体
                    function markerClick(e) {
                        infoWindow.setContent(e.target.content);
                        infoWindow.open(map, e.target.getPosition());
                    }

                    //关闭信息窗体
                    function closeInfoWindow() {
                        map.clearInfoWindow();
                    }


                    //                        var position = [116.397428, 39.90923];
                    //                        //自定义marker图示
                    //                        AMapUI.loadUI(['overlay/SimpleMarker'], function(SimpleMarker) {
                    //                            //启动页面
                    //                            initPage(SimpleMarker);
                    //                        });
                    //                        var startPoint = null;
                    //                        var dangerPoint = null;
                    //
                    //                        function initPage(SimpleMarker) {
                    //                            //创建危险点
                    //                            var dangerPoint1 = new SimpleMarker({
                    //                                //前景文字
                    //                                iconLabel: {
                    //                                    innerHTML: '<i>危</i>', //设置文字内容
                    //                                    style: {
                    //                                        color: 'white' //设置文字颜色
                    //                                    }
                    //                                },
                    //                                //图标主题
                    //                                iconTheme: 'default',
                    //                                //背景图标样式
                    //                                iconStyle: 'red',
                    //                                //...其他Marker选项...，不包括content
                    //                                map: map,
                    //                                position: [116.382122, 39.901176]
                    //                            });
                    //                            startPoint = startPoint2;
                    //                            dangerPoint = dangerPoint1;
                    //                        }
                    //
                    //                        var infoData = {
                    //                            title: '挖掘机',
                    //                            img: 'i/header.jpg',
                    //                            body: '这是一条路由线路',
                    //                        };
                    //                        AMapUI.loadUI(['overlay/SimpleInfoWindow'], function(SimpleInfoWindow) {
                    //                            var infoWindow = new SimpleInfoWindow({
                    //                                //模板, underscore
                    //                                infoTitle: '<strong><%- title %></strong>',
                    //                                infoBody: '<p class="my-desc">' +
                    //                                    //<%= 原值插入 ..
                    //                                    '<%= img %>' +
                    //                                    //'<img src="i/header.jpg />'+
                    //                                    //<%- html编码后插入
                    //                                    '<%- body %>' +
                    //                                    '</p>',
                    //                                //模板数据
                    //                                infoTplData: {
                    //                                    title: infoData.title,
                    //                                    img: infoData.img,
                    //                                    body: infoData.body
                    //                                },
                    //                                //基点指向marker的头部位置
                    //                                offset: new AMap.Pixel(0, -30)
                    //                            });
                    //
                    //
                    //                            var dangerInfo = new SimpleInfoWindow({
                    //                                //模板, underscore
                    //                                infoTitle: '<strong><%- title %></strong>',
                    //                                infoBody: '<p class="my-desc">' +
                    //                                    //<%= 原值插入 ..
                    //                                    '<%= img %>' +
                    //                                    //<%- html编码后插入
                    //                                    '<%- body %>' +
                    //                                    '</p>',
                    //                                //模板数据
                    //                                infoTplData: {
                    //                                    title: "挖掘机威胁",
                    //                                    img: '<img src="http://img.smx.gov.cn/1shxian/201403/201403130744037_b.jpg" />',
                    //                                    body: "只是一张对光缆有威胁的挖掘机点"
                    //                                },
                    //                                //基点指向marker的头部位置
                    //                                offset: new AMap.Pixel(0, -40)
                    //                            });
                    //
                    //                            function openInfoWin() {
                    //                                infoWindow.open(map, startPoint.getPosition());
                    //                            }
                    //
                    //                            //marker 点击时打开
                    //                            AMap.event.addListener(startPoint, 'click', function() {
                    //                                openInfoWin();
                    //                            });
                    //
                    //                            function dangerInfoWin() {
                    //                                dangerInfo.open(map, dangerPoint.getPosition());
                    //                            }
                    //
                    //                            AMap.event.addListener(dangerPoint, 'click', function() {
                    //                                dangerInfoWin();
                    //                            });
                    //
                    //                        });
                    //
                    //                        var lineArr = [
                    //                            [116.368904, 39.913423],
                    //                            [116.382122, 39.901176],
                    //                            [116.387271, 39.912501],
                    //                            [116.398258, 39.904600],
                    //                        ];
                    //
                    //
                    //
                    //
                    //                        AMapUI.load(['ui/misc/PointSimplifier', 'lib/$'], function(PointSimplifier, $) {
                    //
                    //                            if (!PointSimplifier.supportCanvas) {
                    //                                alert('当前环境不支持 Canvas！');
                    //                                return;
                    //                            }
                    //
                    //                            var pointSimplifierIns = new PointSimplifier({
                    //                                zIndex: 115,
                    //                                autoSetFitView: false,
                    //                                map: map, //所属的地图实例
                    //
                    //                                getPosition: function(item) {
                    //                                    if (!item) {
                    //                                        return null;
                    //                                    }
                    //
                    //                                    var parts = item.split(',');
                    //
                    //                                    return [parseFloat(parts[0]), parseFloat(parts[1])];
                    //                                },
                    //                                getHoverTitle: function(dataItem, idx) {
                    //                                    return '序号: ' + idx;
                    //                                },
                    //                                //使用GroupStyleRender
                    //                                renderConstructor: PointSimplifier.Render.Canvas.GroupStyleRender,
                    //                                renderOptions: {
                    //                                    eventSupport: false, //禁止事件,对性能更友好
                    //                                    //点的样式
                    //                                    pointStyle: {
                    //                                        fillStyle: null,
                    //                                        width: 5,
                    //                                        height: 5
                    //                                    },
                    //                                    topNAreaStyle: null,
                    //                                    getGroupId: function(item, idx) {
                    //
                    //                                        //随机返回一个组ID
                    //                                        return Math.ceil(colors.length * Math.random());
                    //                                    },
                    //                                    groupStyleOptions: function(gid) {
                    //
                    //                                        //随机设置大小
                    //                                        var radius = 10 + 10 * Math.random();
                    //
                    //                                        return {
                    //
                    //                                            pointStyle: radius > 0 ? {
                    //                                                content: function(ctx, x, y, width, height) {
                    //
                    //                                                    var p = {
                    //                                                        x: x + width / 2,
                    //                                                        y: y + height / 2,
                    //                                                        radius: radius
                    //                                                    };
                    //
                    //                                                    ctx.beginPath();
                    //                                                    var gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius);
                    //                                                    gradient.addColorStop(0, "rgba(255,0,0,1)");
                    //                                                    gradient.addColorStop(1, "rgba(255,0,0,0.1)");
                    //                                                    ctx.fillStyle = gradient;
                    //                                                    ctx.arc(p.x, p.y, p.radius, Math.PI * 2, false);
                    //                                                    ctx.fill();
                    //
                    //                                                },
                    //
                    //                                                //fillStyle: colors[gid % colors.length],
                    //                                                width: radius * 2,
                    //                                                height: radius * 2
                    //                                            } : null,
                    //                                            pointHardcoreStyle: {
                    //                                                width: radius * 2 + 3,
                    //                                                height: radius * 2 + 3
                    //                                            }
                    //                                        };
                    //                                    }
                    //
                    //                                }
                    //                            });
                    //                            //重复render
                    //                            setInterval(function() {
                    //                                pointSimplifierIns.render();
                    //                            }, 500)
                    //
                    //                            var data = new Array();
                    //                            data[0] = [116.382122, 39.901176];
                    //                            pointSimplifierIns.setData(data);
                    //                            $('#loadingTip').remove();
                    //                        });
                </script>
            </div>
        </div>
    </div>
</div>
</body>
</html>
