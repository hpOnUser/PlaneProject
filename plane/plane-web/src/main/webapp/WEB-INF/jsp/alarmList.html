<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>告警显示</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="css/style.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="js/jquery-3.3.1.js"></script>
    <script type="text/javascript" src="js/jquery.form.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/highcharts-4.1.min.js"></script>
    <script type="text/javascript" src="js/oc.min.js"></script>
    <script type="text/javascript" src="js/calendar.min.js"></script>
    <link rel="icon" type="image/png" href="i/ico.png" sizes="16x16">
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css" />
    <script src="http://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="http://webapi.amap.com/maps?v=1.4.6&key=82f9e75505b649be9ab81a45ae34aa14"></script>
    

</head>
<body>
	<#include "common/header.html" />
    <#include "./nav.html" />
     <div class="content">
    <div class="container-fluid">

        <div class="row-fluid">
            <div class="block span6">
                <div id="container"></div>
                <script type="text/javascript"
                        src="//webapi.amap.com/maps?v=1.4.6&key=82f9e75505b649be9ab81a45ae34aa14"></script>
                <!-- UI组件库 1.0 -->
                <script src="//webapi.amap.com/ui/1.0/main.js?v=1.0.11"></script>
                <script type="text/javascript">
                    //创建一个地图
                    var map = new AMap.Map('container', {
                        resizeEnable: true,
                        center: [116.397428, 39.90923],
                        zoom: 13
                    });

                    alert(JSON.stringify(${alarmList}));
                    alarmList =${alarmList};

                    //闪烁点
                    //just some colors
                    var colors = [
                        '#0cc2f2',
                        '#4fd2b1',
                        '#90e36f',
                        '#ffe700',
                        '#ff9e00',
                        '#ff6700',
                        '#ff1800'
                    ];
                    AMapUI.load(['ui/misc/PointSimplifier', 'lib/$'], function (PointSimplifier, $) {

                        if (!PointSimplifier.supportCanvas) {
                            alert('当前环境不支持 Canvas！');
                            return;
                        }

                        var pointSimplifierIns = new PointSimplifier({
                            zIndex: 115,
                            autoSetFitView: false,
                            map: map, //所属的地图实例

                            getPosition: function (item) {
                                if (!item) {
                                    return null;
                                }

                                var parts = item.split(',');

                                return [parseFloat(parts[0]), parseFloat(parts[1])];
                            },
                            getHoverTitle: function (dataItem, idx) {
                                return '序号: ' + idx;
                            },
                            //使用GroupStyleRender
                            renderConstructor: PointSimplifier.Render.Canvas.GroupStyleRender,
                            renderOptions: {
                                eventSupport: false, //禁止事件,对性能更友好
                                //点的样式
                                pointStyle: {
                                    fillStyle: null,
                                    width: 5,
                                    height: 5
                                },
                                topNAreaStyle: null,
                                getGroupId: function (item, idx) {

                                    //随机返回一个组ID
                                    return Math.ceil(colors.length * Math.random());
                                },
                                groupStyleOptions: function (gid) {

                                    //随机设置大小
                                    var radius = 10 + 10 * Math.random();

                                    return {

                                        pointStyle: radius > 0 ? {
                                            content: function (ctx, x, y, width, height) {

                                                var p = {
                                                    x: x + width / 2,
                                                    y: y + height / 2,
                                                    radius: radius
                                                };

                                                ctx.beginPath();
                                                var gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.radius);
                                                gradient.addColorStop(0, "rgba(255,0,0,1)");
                                                gradient.addColorStop(1, "rgba(255,0,0,0.1)");
                                                ctx.fillStyle = gradient;
                                                ctx.arc(p.x, p.y, p.radius, Math.PI * 2, false);
                                                ctx.fill();

                                            },

                                            //fillStyle: colors[gid % colors.length],
                                            width: radius * 2,
                                            height: radius * 2
                                        } : null,
                                        pointHardcoreStyle: {
                                            width: radius * 2 + 3,
                                            height: radius * 2 + 3
                                        }
                                    };
                                }

                            }
                        });
                        //重复render
                        setInterval(function () {
                            pointSimplifierIns.render();
                        }, 500)

                        var data = new Array();
                        for(var i=0;i<alarmList.length;i++){
                            data[i] = alarmList[i].alongda;
                        }
                        pointSimplifierIns.setData(data);
                        $('#loadingTip').remove();
                    });
                </script>
            </div>
        </div>
    </div>
</div>